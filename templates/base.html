<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/css/nulble.css">
    <link rel="stylesheet" href="/static/css/main.css">

    <title>Blog App</title>
    {% block head %}

    {% endblock %}
</head>

<body>
    <nav class="nav">
        <h1 class="nav-title"> Blog App</h1>
        <ul class="nav-links">
            <li class="nav-link"><a href="{%url 'home'%}">Home</a></li>
            <li class="nav-link"><a href="{%url 'about'%}">About</a></li>
            {% if user.is_authenticated %}
            <li class="nav-link"><a href="{%url 'profile'%}">Profile</a></li>
            <li class="nav-link"><a href="{%url 'create_blog_entry'%}">Create post</a></li>
            <li class="nav-link"><a href="{% url 'logout' %}">Logout ({{request.user.username}})</a></li>
            {% else %}
            <li class="nav-link"><a href="{%url 'registration'%}">Registrate</a></li>
            <li class="nav-link"><a href="{%url 'login'%}">Login</a></li>
            {% endif %}
        </ul>
    </nav>
    {% block content %}

    {% endblock %}
    {% if messages %}
    <ul class="messages">
        {% for message in messages %}
        <div class="massage">
            <li {% if message.tags %} class="{{ message.tags }}" {% endif %}>
                <p>{{ message }}</p>
                <button class="message-close-btn" onclick="CloseMassage(this)">
                    <svg class="progress-ring" width="55" height="55">
                        <circle class="progress-ring-circle" stroke="black" stroke-width="3" fill="transparent" r="20"
                            cx="20" cy="27">
                        </circle>
                    </svg>

                    <img src="/static/img/cross-mark-svgrepo-com.png" alt="Close">
                </button>
            </li>
        </div>

        {% endfor %}
    </ul>
    {% endif %}

</body>
<script>
    function CloseMassage(btn) {
        let message = btn.parentElement;
        message.remove();
    }
    document.addEventListener('DOMContentLoaded', function () {
        let messages = document.querySelectorAll(".messages li");
        messages.forEach((message) => {
            let timeout = 15000;
            let circle = message.querySelector(".progress-ring-circle");
            if (!circle) {
                return
            }

            let radius = circle.r.baseVal.value;
            let dis = 2 * Math.PI * radius;
            console.log("Radius: dis", radius, dis);

            // let timer=setTimeout(()=>{

            //     console.log("Delete 15 seconds passed");
            //     message.remove();

            // }, timeout);

            let totalSteps = timeout / 1000;
            let step = 0

            circle.style.strokeDasharray = `${dis} ${dis}`;
            circle.style.strokeDashoffset = 0;

            let interval = setInterval(() => {
                console.log("Interval");
                step++;
                let progres = step / totalSteps;
                let offset = dis * progres;
                circle.style.strokeDashoffset = offset

                if (step >= totalSteps) {
                    clearInterval(interval);
                    message.remove();
                }

            }, 1000)
        });

    }
    
    );
    document.addEventListener('DOMContentLoaded', function () {
        const navLinks = document.querySelectorAll('.nav-link');
        const currentPath = window.location.pathname;

        navLinks.forEach(link => {
            const anchor = link.querySelector('a');
            if (anchor && anchor.pathname === currentPath) {
                link.classList.add('nav-active');
            } else {
                link.classList.remove('nav-active');
            }
        });
    });


</script>

</html>